<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<link href="styles/styles.css" rel="stylesheet" type="text/css">
<link href="css/availabilitypage.css" rel="stylesheet" type="text/css">
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.652.0.min.js"></script>
<script type="text/javascript">
function initMap() {
	var locations = [
	      ['Slot 1', 37.655656, -122.057867, 1],
	      ['Slot 2', 37.657963, -122.052656, 2],
	      ['Slot 3', 37.659326, -122.054388, 3],
	      ['Slot 4', 37.659597, -122.056430, 4],
	      ['Slot 5', 37.656038, -122.052505, 5]
	    ];

	    var map = new google.maps.Map(document.getElementById('map'), {
	      zoom: 16,
	      center: new google.maps.LatLng(37.657742, -122.056259),
	      mapTypeId: google.maps.MapTypeId.ROADMAP
	    });

	    var infowindow = new google.maps.InfoWindow();

	    var marker, i;

	    for (i = 0; i < locations.length; i++) {  
	      marker = new google.maps.Marker({
	        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
	        map: map
	      });

	      google.maps.event.addListener(marker, 'click', (function(marker, i) {
	        return function() {
	          infowindow.setContent(locations[i][0]);
	          infowindow.open(map, marker);
	        }
	      })(marker, i));
	    }
  }

    AWS.config.update({
  	  region: "us-east-2",
  	  endpoint: 'http://dynamodb.us-east-2.amazonaws.com',
  	  accessKeyId: "AKIASUU5L6BWABM3DQEC",
  	  secretAccessKey: "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"
  	});  
   
  var dynamodb = new AWS.DynamoDB();
  var docClient = new AWS.DynamoDB.DocumentClient();
  var ddb = new AWS.DynamoDB({apiVersion: '2012-08-10'});
  let slotMap=new Map();
  slotMap["Slot1"]=0;
  slotMap["Slot2"]=1;
  function loadref(time)
  {
  	queryData("Slot1");
  	//queryData("Slot2");
  setTimeout("location.reload(true);",time);
  } 

  function queryData(slotId) {
  	
      var params = {
          TableName : "SlotAvailability",
          ScanIndexForward: false,
          KeyConditionExpression: "#sname = :SensorName",
          ExpressionAttributeNames:{
              "#sname": "SensorName"
          },
          ExpressionAttributeValues: {
          	":SensorName":slotId
          }, 
          Limit:1 
      };
      docClient.query(params, function(err, data) {
          if (err) {
              
          } else {
          	
              data.Items.forEach(function(movie) {
                  
                  if(movie.Distance>20)
                  {
                  	document.getElementById('slottable').rows[1].cells[0].className="empty";
                  	document.getElementById('slottable').rows[1].cells[SlotMap[slotId]].innerHTML="EMPTY"
                  }
                  else
                  {
                  	document.getElementById('slottable').rows[1].cells[0].className="full";
                  	document.getElementById('slottable').rows[1].cells[slotMap[slotId]].innerHTML="FULL"
                  }
              });
           
          }
      });
  }
function loadReservation()
{
	window.location.href="ReservationPage.html";
}
    </script>
    
 <script defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzyOaqAYHjR_UtKv4X25gmw4NeX5aHuHY&callback=initMap">
    </script> 
    
</head>
<body onload="Javascript:loadref(20000)">
<header>
	 <div class="topnav">
	 <div align="left"> 
		 <a	class="active" id="home" href="availability.html" >HOME</a>	
          <a  id="about" href="About.html" >ABOUT</a>		
          <a  id="contact"href="Contact.html" >CONTACT US</a>
          </div>	
          <div style="left-padding:100px">
          <a  id="booking" href="Bookings.html">My Bookings</a>	
          <a  id="account"href="Myaccount.html" >My Account</a>		
		</div>
		</div>
</header>
<div class="row">
  <div class="column" id="map">
  </div>
  <div class="column" style="background-image: url('images/backgroundwhite.jpg'); background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
  position: relative;">
    </br>
 </br>
</br>
 <div align="center" >
 <table id="slottable"  class="myTable"  >
  <tr>
    <th>Slot 1</th>
    <th>Slot 2</th>
    <th>Slot 3</th>
    <th>Slot 4</th>
    <th>Slot 5</th>
  </tr>
  <tr>
    <td></td>
    <td class="empty">EMPTY</td>
    <td class="empty">EMPTY</td>
    <td class="empty">EMPTY</td>
    <td class="empty">EMPTY</td>
  </tr>
</table>
</br>
</br>
<button class="button" align="center" onClick= "loadReservation()">Reserve Slot</button>
</div>
</br>
</br>
    
    
  </div>
</div>
</body>
</html>