<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="shortcut icon" type="image/jpg" href="images/parking icon.jpg">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.652.0.min.js"></script>
<script type="text/javascript">

 AWS.config.update({
  region: "us-east-2",
  endpoint: 'http://dynamodb.us-east-2.amazonaws.com',
  accessKeyId: "AKIASUU5L6BWABM3DQEC",
  secretAccessKey: "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"
});  
var dynamodb = new AWS.DynamoDB();
var docClient = new AWS.DynamoDB.DocumentClient();
var ddb = new AWS.DynamoDB({apiVersion: '2012-08-10'});


function adduser(password)
{
	const name=document.getElementById('name').value;
	console.log(name);
	const email=document.getElementById('email').value;
	console.log(email);
	if(validateEmail(email))
	{
	console.log(password);
	var passlen=password.length;
	if(passlen>0){
	const number=document.getElementById('number').value;
	console.log(number)
	if(/^\d{10}$/.test(number))
		{
	var params={
		 TableName : "UserTypeCount",
		 
	        KeyConditionExpression: "#susername = :UserType",
	        ExpressionAttributeNames:{
	            "#susername": "UserType"
	        },
	        ExpressionAttributeValues: {
	        	":UserType":"Admin"
	        }
	        
	};
	console.log("after params");
	console.log("after params");

	docClient.query(params, function(err, data) {
		console.log("in edoc");
		if(err)
			{
			console.error("Unable to scan the table. Error JSON:", JSON.stringify(err, null, 2));
			console.log("in errors");
			}else{
				console.log(data.Count);
				console.log("in admin detaiks");
				data.Items.forEach(function(item)
						{
					var count=item.Count;
					var toinsert=count+1;
					var coustr=toinsert.toString();
					var checkExsistUser={
							ScanIndexForward: false,
							 TableName : "AdminDetails",
						        KeyConditionExpression: "#susername = :UserType",
						        ExpressionAttributeNames:{
						            "#susername": "UserName"
						        },
						        ExpressionAttributeValues: {
						        	":UserType": name
						        },
						        Limit:1
					};
					docClient.query(checkExsistUser, function(err, data1) {
						if(err)
							{
							console.error("Unable to scan the table. Error JSON:", JSON.stringify(err, null, 2));
							console.log("in errors");
							}else{
								console.log(data1);
								console.log(data1.Count);
								if(data1.Count==0)
									{
					var params1={
							TableName : "AdminDetails",
							Item:{
								UserId:{N:coustr},
								UserName:{S:name},
								PhoneNumber:{S:number},
								Password:{S:password},
								Email:{S:email}
							}
						};
						dynamodb.putItem(params1,function(err, data){
							if (err) console.log(err, err.stack); // an error occurred
							   else     console.log(data);
						});
						var params2={
								TableName : "UserTypeCount",
								Item:{
									UserType:{S:"Admin"},
									Count:{N:coustr}
								}
						};
						dynamodb.putItem(params2,function(err, data){
							if (err) console.log(err, err.stack); // an error occurred
							   else     console.log(data);
						});
						if (window.confirm("Please login now !!!! ")) { 
							   window.location.href="index.html";
						 }	
									}
								else{
									alert("Username already exsists please enter other username");
								}
							}
					});
					});
				
			}
	});
		}else{
			alert("Enter a valid Mobile number");
		}
		}else{
			alert("Please Enter Password");
		}
	}
	else{
		alert("Enter a valid email address");
	}
	
}
function validateEmail(email) {
	  const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
	  return re.test(email);
	}
function phonenumber(inputtxt)
{
  const phoneno = /^\d{10}$/;
  return inputtxt.value.match(phoneno);
}

</script>
</head>

<body style="background-color: #666666;">
<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">		     
   <form class="login100-form validate-form" onsubmit="return false;">
        <!--     <p style="font-family: Arial, Helvetica, sans-serif; font-size:40px; text-align:center">Welcome! </p>--> 
			<p style="font-family: Arial, Helvetica, sans-serif; font-size:40px; text-align:center">Welcome Administrator !!</p>
            <p style="font-family: Arial, Helvetica, sans-serif; font-size:30px; text-align:center"> Smart Parking Management  </p></br>
            </br>
    		<p style="font-family: Arial, Helvetica, sans-serif; font-size:15px; text-align:left"> Please enter below details to create new admin:  </p> <br>
       <div class="wrap-input100 validate-input" data-validate = "Valid name">
						<input class="input100" type="text" name="name" id="name">
						<span class="focus-input100"></span>
						<span class="label-input100">User Name</span>
					</div>		
        <div class="wrap-input100 validate-input" data-validate = "Valid email is required: ex@abc.xyz">
						<input class="input100" type="text" name="email"  id="email" required>
						<span class="focus-input100"></span>
						<span class="label-input100">Email</span>
					</div>
					
					<div class="wrap-input100 validate-input" data-validate="Password is required">
						<input class="input100" type="password" name="pass1" id="pass1">
						<span class="focus-input100"></span>
						<span class="label-input100">Password</span>
					</div>
					 <div class="wrap-input100 validate-input" data-validate = "Valid Number">
						<input class="input100" type="text" name="number" id="number">
						<span class="focus-input100"></span>
						<span class="label-input100">Mobile Number</span>
					</div>
       <button class="login100-form-btn" onclick="adduser(document.getElementById('pass1').value)">Add New Admin</button>
</form> 
    
   
    <div class="login100-more" style="background-image: url('images/Parking lot Image.PNG');">
	</div>
   </div></div></div>
  
</body>

	
<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>

</html>